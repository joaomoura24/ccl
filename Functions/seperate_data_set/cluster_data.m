%--------------------------------------------------------------------------
% Auxiliar functions:
%--------------------------------------------------------------------------
getWFileName = @(w,i) strcat('W_A_new/w',num2str(w),'i',num2str(i),'.mat');
dot_prod = @(a,b) sum(bsxfun(@times,bsxfun(@minus,a,b),bsxfun(@minus,a,b)),1);
%dot_prod = @(a,b) sum(bsxfun(@times,a,b),1);
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
% User input
%--------------------------------------------------------------------------
window_size = 1400;
increment = 50;
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
% Load estimated gains W
%--------------------------------------------------------------------------
file_name = getWFileName(window_size, increment);
load(file_name);
%--------------------------------------------------------------------------
% load('W_true_A');
%--------------------------------------------------------------------------
% Compute Correlation Matrix between W of different windows
%--------------------------------------------------------------------------
W_mat_all = cell2mat(W_hat_vec);
Nwindows = length(W_hat_vec);
W_corr = ones(Nwindows);
tic;
for idx=1:Nwindows
    W_corr(idx,idx:end) = dot_prod(W_mat_all(:,idx),W_mat_all(:,idx:end));
end
%W_corr = sqrt(abs(W_corr.*W_corr.'));
toc
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
% Display correlation Matrix
%--------------------------------------------------------------------------
imagesc(W_corr); colorbar; colormap jet;
%caxis([1 3]);
%--------------------------------------------------------------------------