%% Add path
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
addpath(genpath('../')); % add the library and it's subfolders to the path
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------

%% Get data
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
fprintf(1,'Getting data ...\n');
load('data_test_paper.mat');
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------

%% Get reference seperation data
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
fprintf(1,'Get reference seperation ...\n');
file_name = 'ref_r_paper.mat';
if exist(file_name,'file')
    load(file_name);
else
    data = cell2mat(x{1});
    plot(data.');
    [r,~] = ginput(12);
    ri = r(1:2:end);
    rf = r(2:2:end);
    save(file_name,'ri','rf');
end
NDem = length(ri);
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------

%% Seperate data in files:
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
xx = x; uu = u; tt = t;
x = cell(1, NDem);
u = cell(1, NDem);
t = cell(1, NDem);
for idx = 1:NDem
    x{idx} = xx{1}(ri(idx):rf(idx));
    u{idx} = uu{1}(ri(idx):rf(idx));
    t{idx} = tt{1}(ri(idx):rf(idx));
    t{idx} = gsubtract(t{idx}(1:end),t{idx}{1});
end
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
save('data_ref_paper_sep.mat','x','u','t');